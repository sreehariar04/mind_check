{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotional Analysis | MindCheck</title>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&family=DM+Serif+Display:ital@0;1&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body class="mindcheck-app">
    {% include 'monitor/_sidebar.html' with active='journal' %}

    <main class="main">
        <div class="success-banner">✅ Journal analyzed successfully.</div>

        <h1 class="page-title">Your Emotional Profile</h1>
        <p class="page-sub">Based on your recent journal entry</p>

        <div class="entry-preview">{{ entry.content }}</div>

        <section class="results-grid">
            <article class="card">
                <span class="card-label">Emotional Intensity Analysis</span>

                <!-- Emotion badge with dynamic colour -->
                <div class="emotion-badge" style="
                    {% if result.emotion == 'joy_excitement' %}background:rgba(245,200,66,0.15); color:#a07d00;{% endif %}
                    {% if result.emotion == 'affection' %}background:rgba(232,121,154,0.15); color:#a0305a;{% endif %}
                    {% if result.emotion == 'anger_disgust' %}background:rgba(224,90,78,0.15); color:#a02a22;{% endif %}
                    {% if result.emotion == 'sadness_grief' %}background:rgba(107,143,190,0.15); color:#2d5080;{% endif %}
                    {% if result.emotion == 'fear_nervousness' %}background:rgba(155,107,181,0.15); color:#5c2e80;{% endif %}
                    {% if result.emotion == 'cognitive' %}background:rgba(91,168,156,0.15); color:#245c55;{% endif %}
                    {% if result.emotion == 'neutral' %}background:rgba(154,165,180,0.15); color:#4a5566;{% endif %}
                ">
                    <span class="badge-dot" style="
                        {% if result.emotion == 'joy_excitement' %}background:#F5C842{% endif %}
                        {% if result.emotion == 'affection' %}background:#E8799A{% endif %}
                        {% if result.emotion == 'anger_disgust' %}background:#E05A4E{% endif %}
                        {% if result.emotion == 'sadness_grief' %}background:#6B8FBE{% endif %}
                        {% if result.emotion == 'fear_nervousness' %}background:#9B6BB5{% endif %}
                        {% if result.emotion == 'cognitive' %}background:#5BA89C{% endif %}
                        {% if result.emotion == 'neutral' %}background:#9AA5B4{% endif %}
                    ;"></span>
                    {{ result.display_emotion }}
                </div>

                <div class="radar-wrap">
                    <canvas id="radarChart"></canvas>
                </div>

                <div class="metric-boxes">
                    <div class="mbox">
                        <span class="mbox-label">Detected</span>
                        <div class="mbox-value">{{ result.display_emotion }}</div>
                    </div>
                    <div class="mbox">
                        <span class="mbox-label">Confidence</span>
                        <div class="mbox-value">{{ result.confidence_percent }}%</div>
                    </div>
                    <div class="mbox">
                        <span class="mbox-label">Polarity</span>
                        <div class="mbox-value">
                            {% if result.emotion == 'joy_excitement' or result.emotion == 'affection' %}Positive
                            {% elif result.emotion == 'neutral' or result.emotion == 'cognitive' %}Balanced
                            {% else %}Negative{% endif %}
                        </div>
                    </div>
                </div>
            </article>

            <div class="right-col">
                <article class="interp-card">
                    <span class="interp-label">MindCheck Interpretation</span>
                    <p class="interp-text">{{ suggestion }}</p>
                </article>

                <article class="actions-card">
                    <h2 class="actions-title">Suggested Actions</h2>
                    <div class="action-item"><span class="action-arrow">→</span><span>Continue journaling consistently
                            to build a comprehensive emotional map</span></div>
                    <div class="action-item"><span class="action-arrow">→</span><span>Reflect on recurring themes across
                            multiple entries over time</span></div>
                    <div class="action-item"><span class="action-arrow">→</span><span>Visit Insights after 5+ entries to
                            unlock your trend analysis</span></div>
                </article>
            </div>
        </section>

        <div class="action-btns">
            <a href="{% url 'journal' %}" class="btn-primary">Write New Reflection</a>
            <a href="{% url 'dashboard' %}" class="btn-ghost">View Dashboard</a>
        </div>
    </main>

    {{ radar_labels|json_script:'rl' }}
    {{ radar_values|json_script:'rv' }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const rl = JSON.parse(document.getElementById('rl').textContent);
        const rv = JSON.parse(document.getElementById('rv').textContent);
        const EMOTION_COLORS = { joy_excitement: '#F5C842', affection: '#E8799A', anger_disgust: '#E05A4E', sadness_grief: '#6B8FBE', fear_nervousness: '#9B6BB5', cognitive: '#5BA89C', neutral: '#9AA5B4' };
        const emotion = '{{ result.emotion }}';
        const color = EMOTION_COLORS[emotion] || '#52b788';

        new Chart(document.getElementById('radarChart'), {
            type: 'radar',
            data: {
                labels: rl,
                datasets: [{ data: rv, borderColor: color, backgroundColor: color + '22', pointBackgroundColor: color, pointBorderColor: '#fff', pointBorderWidth: 2, pointRadius: 4, borderWidth: 2 }]
            },
            options: {
                responsive: true, maintainAspectRatio: true,
                scales: { r: { min: 0, max: 100, ticks: { stepSize: 25, backdropColor: 'transparent', color: '#aaa', font: { size: 10 } }, angleLines: { color: '#eee' }, grid: { color: '#eee' }, pointLabels: { color: '#555', font: { size: 11, weight: 600 } } } },
                plugins: { legend: { display: false } }
            }
        });
    </script>
</body>

</html>